{"version":3,"sources":["../../src/core/define-plugin.ts","../../src/utilities/add-devtoolbar-framework-app.ts","../../src/core/create-resolver.ts","../../src/utilities/add-virtual-imports.ts","../../src/utilities/has-vite-plugin.ts","../../src/utilities/add-vite-plugin.ts","../../src/plugins/add-devtoolbar-framework-app.ts","../../src/utilities/add-dts.ts","../../src/plugins/add-dts.ts","../../src/utilities/add-integration.ts","../../src/utilities/has-integration.ts","../../src/plugins/add-integration.ts","../../src/plugins/add-virtual-imports.ts","../../src/plugins/add-vite-plugin.ts","../../src/plugins/has-integration.ts","../../src/plugins/has-vite-plugin.ts","../../src/utilities/inject-dev-route.ts","../../src/plugins/inject-dev-route.ts","../../src/utilities/watch-integration.ts","../../src/plugins/watch-integration.ts","../../src/plugins/index.ts"],"sourcesContent":["import type { Hooks, Plugin } from \"./types.js\";\n\n/**\n * Allows defining a type-safe plugin that can be used in {defineIntegration}.\n *\n * @param {object} plugin\n * @param {string} plugin.name - The name of the plugin, as you want it to be called from the hook\n * @param {string} plugin.hook - The name of the hook where this plugin should be available\n * @param {Function} plugin.implementation - The actual function definition. Refer to docs for usage\n *\n * @see https://astro-integration-kit.netlify.app/utilities/define-plugin/\n *\n * ```ts\n * import { definePlugin } from \"../core/define-plugin.js\";\n * import { addVitePlugin } from \"../utilities/add-vite-plugin.js\";\n * import type { Plugin as VitePlugin } from \"vite\"\n *\n * export const addVitePluginPlugin = definePlugin({\n * \t\tname: \"addVitePlugin\",\n * \t\thook: \"astro:config:setup\",\n * \t\timplementation: ({ updateConfig }) => (plugin: VitePlugin) => addVitePlugin({ plugin, updateConfig }),\n * });\n * ```\n */\nexport const definePlugin = <\n\tTName extends string,\n\tTHook extends keyof Hooks,\n\tTImplementation extends (...args: Array<any>) => any,\n>(\n\tplugin: Plugin<TName, THook, TImplementation>,\n) => plugin;\n","import { readFileSync } from \"node:fs\";\nimport { type HookParameters } from \"astro\";\nimport { createResolver } from \"../core/create-resolver.js\";\nimport { addVirtualImports } from \"./add-virtual-imports.js\";\n\ntype SupportedFrameworks = \"react\" | \"preact\" | \"vue\" | \"svelte\" | \"solid\";\n\nexport type AddDevToolbarFrameworkAppParams = {\n\tid: string;\n\tname: string;\n\ticon: string;\n\tframework: SupportedFrameworks;\n\tsrc: string;\n\tstyle?: string;\n} & Pick<\n\tHookParameters<\"astro:config:setup\">,\n\t\"config\" | \"addDevToolbarApp\" | \"updateConfig\" | \"injectScript\"\n>;\n\n/**\n * Add a Dev Toolbar Plugin that uses a Framework component.\n *\n * @param {object} params\n * @param {string} params.name - The name of the toolbar plugin\n * @param {string} params.icon - This should be an inline SVG\n * @param {string} params.framework - The framework your component is using. Can be either \"react\", \"vue\", \"svelte\", \"solid\", or \"preact\"\n * @param {URL} params.src - Path to your component\n * @param {string} params.style - A stylesheet to pass to your plugin\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"config\"]} params.config\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"updateConfig\"]} params.updateConfig\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"addDevToolbarApp\"]} params.addDevToolbarApp\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"injectScript\"]} params.injectScript\n *\n * @example\n * ```ts\n * addDevToolbarFrameworkApp({\n *      framework: \"vue\",\n *      name: \"Test Vue Plugin\",\n *      id: \"test-vue-plugin\",\n *      icon: `<svg version=\"1.1\" viewBox=\"0 0 261.76 226.69\" xmlns=\"http://www.w3.org/2000/svg\"><g transform=\"matrix(1.3333 0 0 -1.3333 -76.311 313.34)\"><g transform=\"translate(178.06 235.01)\"><path d=\"m0 0-22.669-39.264-22.669 39.264h-75.491l98.16-170.02 98.16 170.02z\" fill=\"#41b883\"/></g><g transform=\"translate(178.06 235.01)\"><path d=\"m0 0-22.669-39.264-22.669 39.264h-36.227l58.896-102.01 58.896 102.01z\" fill=\"#34495e\"/></g></g></svg>`,\n *      src: resolve(\"./Test.vue\"),\n *      style: `\n *          button {\n *              background-color: rebeccapurple;\n *          }\n *      `,\n *      config\n * });\n * ```\n *\n * @see https://astro-integration-kit.netlify.app/utilities/add-devtoolbar-framework-app/\n */\nexport const addDevToolbarFrameworkApp = ({\n\tid,\n\tname,\n\ticon,\n\tframework,\n\tsrc,\n\tstyle,\n\tconfig,\n\taddDevToolbarApp,\n\tupdateConfig,\n\tinjectScript,\n}: AddDevToolbarFrameworkAppParams) => {\n\tconst virtualModuleName = `virtual:astro-devtoolbar-app-${id}`;\n\n\tconst { resolve } = createResolver(import.meta.url);\n\n\tlet content = readFileSync(\n\t\tresolve(`../stubs/add-devtoolbar-framework-app/${framework}.js`),\n\t\t\"utf-8\",\n\t);\n\n\tconst escapedIcon = icon.replace(\"`\", '${\"`\"}');\n\n\tcontent = content\n\t\t.replace(\"@@COMPONENT_SRC@@\", src)\n\t\t.replace(\"@@ID@@\", id)\n\t\t.replace(\"@@NAME@@\", name)\n\t\t.replace(\"@@ICON@@\", escapedIcon)\n\t\t.replace(\"@@STYLE@@\", style ?? \"\");\n\n\taddVirtualImports({\n\t\tname: id,\n\t\timports: { [virtualModuleName]: content },\n\t\tconfig,\n\t\tupdateConfig,\n\t});\n\n\tif (framework === \"react\") {\n\t\timport(\"@vitejs/plugin-react\").then((react) => {\n\t\t\tconst FAST_REFRESH_PREAMBLE = react.default.preambleCode;\n\t\t\tconst preamble = FAST_REFRESH_PREAMBLE.replace(\"__BASE__\", \"/\");\n\t\t\tinjectScript(\"page\", preamble);\n\t\t});\n\t}\n\n\taddDevToolbarApp(virtualModuleName);\n};\n","import { fileURLToPath } from \"node:url\";\nimport { dirname, resolve } from \"pathe\";\n\n/**\n * Allows resolving paths relatively to the integration folder easily. Call it like this:\n *\n * @param {string} _base - The location you want to create relative references from. `import.meta.url` is usually what you'll want.\n *\n * @see https://astro-integration-kit.netlify.app/utilities/create-resolver/\n *\n * @example\n * ```ts\n * const { resolve } = createResolver(import.meta.url);\n * const pluginPath = resolve(\"./plugin.ts\");\n * ```\n *\n * This way, you do not have to add your plugin to your package.json `exports`.\n */\nexport const createResolver = (_base: string) => {\n\tlet base = _base;\n\tif (base.startsWith(\"file://\")) {\n\t\tbase = dirname(fileURLToPath(base));\n\t}\n\n\treturn {\n\t\tresolve: (...path: Array<string>) => resolve(base, ...path),\n\t};\n};\n","import { AstroError } from \"astro/errors\";\nimport type { Plugin } from \"vite\";\nimport type { HookParameters } from \"../core/types.js\";\nimport { addVitePlugin } from \"./add-vite-plugin.js\";\nimport { hasVitePlugin } from \"./has-vite-plugin.js\";\n\ntype VirtualImport = {\n\tid: string;\n\tcontent: string;\n\tcontext?: \"server\" | \"client\" | undefined;\n};\n\ntype Imports = Record<string, string> | Array<VirtualImport>;\n\nconst incrementPluginName = (name: string) => {\n\tlet count = 1;\n\treturn `${name.replace(/-(\\d+)$/, (_, c) => {\n\t\tcount = parseInt(c) + 1;\n\t\treturn \"\";\n\t})}-${count}`;\n};\n\nconst resolveVirtualModuleId = <T extends string>(id: T): `\\0${T}` => {\n\treturn `\\0${id}`;\n};\n\nconst createVirtualModule = (name: string, _imports: Imports): Plugin => {\n\t// We normalize the imports into an array\n\tconst imports: Array<VirtualImport> = Array.isArray(_imports)\n\t\t? _imports\n\t\t: Object.entries(_imports).map(([id, content]) => ({\n\t\t\t\tid,\n\t\t\t\tcontent,\n\t\t\t\tcontext: undefined,\n\t\t  }));\n\n\t// We check for virtual imports with overlapping contexts, eg. several imports\n\t// with the same id and context server\n\tconst duplicatedImports: Record<string, Array<string>> = {};\n\tfor (const { id, context } of imports) {\n\t\tduplicatedImports[id] ??= [];\n\t\tduplicatedImports[id]?.push(\n\t\t\t...(context === undefined ? [\"server\", \"client\"] : [context]),\n\t\t);\n\t}\n\tfor (const [id, contexts] of Object.entries(duplicatedImports)) {\n\t\tif (contexts.length !== [...new Set(contexts)].length) {\n\t\t\tthrow new AstroError(\n\t\t\t\t`Virtual import with id \"${id}\" has been registered several times with conflicting contexts.`,\n\t\t\t);\n\t\t}\n\t}\n\n\tconst resolutionMap = Object.fromEntries(\n\t\timports.map(({ id }) => {\n\t\t\tif (id.startsWith(\"astro:\")) {\n\t\t\t\tthrow new AstroError(\n\t\t\t\t\t`Virtual import name prefix can't be \"astro:\" (for \"${id}\") because it's reserved for Astro core.`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn [resolveVirtualModuleId(id), id];\n\t\t}),\n\t);\n\n\treturn {\n\t\tname,\n\t\tresolveId(id) {\n\t\t\tif (imports.find((_import) => _import.id === id)) {\n\t\t\t\treturn resolveVirtualModuleId(id);\n\t\t\t}\n\t\t\treturn;\n\t\t},\n\t\tload(id, options) {\n\t\t\tconst resolution = resolutionMap[id];\n\t\t\tif (resolution) {\n\t\t\t\tconst context = options?.ssr ? \"server\" : \"client\";\n\t\t\t\tconst data = imports.find((_import) =>\n\t\t\t\t\t_import.id === resolution && _import.context === undefined\n\t\t\t\t\t\t? true\n\t\t\t\t\t\t: _import.context === context,\n\t\t\t\t);\n\n\t\t\t\tif (data) {\n\t\t\t\t\treturn data.content;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t},\n\t};\n};\n\ntype HookParameterProperties = Pick<\n\tHookParameters<\"astro:config:setup\">,\n\t\"config\" | \"updateConfig\"\n>;\n\n/**\n * Creates a Vite virtual module and updates the Astro config.\n * Virtual imports are useful for passing things like config options, or data computed within the integration.\n *\n * @param {object} params\n * @param {string} params.name\n * @param {Imports} params.imports\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"updateConfig\"]} params.updateConfig\n *\n * @see https://astro-integration-kit.netlify.app/utilities/add-virtual-imports/\n *\n * @example\n * ```ts\n * // my-integration/index.ts\n * import { addVirtualImports } from \"astro-integration-kit\";\n *\n * addVirtualImports(\n * \t\tname: 'my-integration',\n * \t\tconfig,\n * \t\tupdateConfig,\n * \t\timports: {\n * \t\t\t'virtual:my-integration/config': `export default ${ JSON.stringify({foo: \"bar\"}) }`,\n * \t\t}\n * );\n * ```\n *\n * This is then readable anywhere else in your integration:\n *\n * ```ts\n * // myIntegration/src/component/layout.astro\n * import config from \"virtual:my-integration/config\";\n *\n * console.log(config.foo) // \"bar\"\n * ```\n */\nexport const addVirtualImports = ({\n\tname,\n\timports,\n\tconfig,\n\tupdateConfig,\n}: HookParameterProperties & {\n\tname: string;\n\timports: Imports;\n}) => {\n\tlet pluginName = `vite-plugin-${name}`;\n\n\twhile (hasVitePlugin({ plugin: pluginName, config }))\n\t\tpluginName = incrementPluginName(pluginName);\n\n\taddVitePlugin({\n\t\twarnDuplicated: false,\n\t\tplugin: createVirtualModule(pluginName, imports),\n\t\tupdateConfig,\n\t});\n};\n","import type { AstroConfig, HookParameters } from \"astro\";\nimport type { PluginOption } from \"vite\";\n\nfunction getPluginNames(plugins: AstroConfig[\"vite\"][\"plugins\"]) {\n\tconst names: string[] = [];\n\n\tif (plugins) {\n\t\tfor (const plugin of plugins) {\n\t\t\tif (!plugin) continue;\n\n\t\t\tif (Array.isArray(plugin)) {\n\t\t\t\tnames.push(...getPluginNames(plugin));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (plugin instanceof Promise) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnames.push(plugin.name);\n\t\t}\n\t}\n\n\treturn names;\n}\n\n/**\n * Checks for the existence of a Vite plugin inside the Astro config.\n *\n * @param {Params} params\n * @param {string|import(\"vite\").PluginOption} params.plugin\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"config\"]} params.config\n *\n * @see https://astro-integration-kit.netlify.app/utilities/has-vite-plugin/\n *\n * @example\n * ```ts\n * hasVitePlugin({\n * \t\tplugin: \"vite-plugin-my-integration\",\n * \t\tconfig\n * })\n * ```\n */\nexport const hasVitePlugin = ({\n\tplugin,\n\tconfig,\n}: {\n\tplugin: string | PluginOption;\n\tconfig: HookParameters<\"astro:config:setup\">[\"config\"];\n}): boolean => {\n\tif (!plugin || plugin instanceof Promise) return false;\n\n\tconst currentPlugins = new Set(getPluginNames(config?.vite?.plugins));\n\n\tconst plugins = new Set<string>();\n\n\tif (typeof plugin === \"string\") {\n\t\tplugins.add(plugin);\n\t}\n\n\tif (typeof plugin === \"object\") {\n\t\tif (Array.isArray(plugin)) {\n\t\t\tconst names = new Set(\n\t\t\t\tgetPluginNames(plugin as NonNullable<AstroConfig[\"vite\"][\"plugins\"]>),\n\t\t\t);\n\t\t\tfor (const name of names) plugins.add(name);\n\t\t} else {\n\t\t\tplugins.add(plugin.name);\n\t\t}\n\t}\n\n\treturn [...plugins].some((name) => currentPlugins.has(name));\n};\n","import type { HookParameters } from \"astro\";\nimport type { Plugin, PluginOption } from \"vite\";\nimport { hasVitePlugin } from \"./has-vite-plugin.js\";\n\ninterface CommonOptions {\n\tplugin: PluginOption;\n\tupdateConfig: HookParameters<\"astro:config:setup\">[\"updateConfig\"];\n}\n\ninterface UnsafeOptions extends CommonOptions {\n\twarnDuplicated: false;\n\tconfig?: HookParameters<\"astro:config:setup\">[\"config\"];\n\tlogger?: HookParameters<\"astro:config:setup\">[\"logger\"];\n}\n\ninterface SafeOptions extends CommonOptions {\n\twarnDuplicated?: true;\n\tconfig: HookParameters<\"astro:config:setup\">[\"config\"];\n\tlogger: HookParameters<\"astro:config:setup\">[\"logger\"];\n}\n\n/**\n * Adds a [vite plugin](https://vitejs.dev/guide/using-plugins) to the\n * Astro config.\n *\n * @param {Params} params\n * @param {boolean} [params.warnDuplicated=true]\n * @param {import(\"vite\").PluginOption} params.plugin\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"config\"]} params.config\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"logger\"]} params.logger\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"updateConfig\"]} params.updateConfig\n *\n * @see https://astro-integration-kit.netlify.app/utilities/add-vite-plugin/\n *\n * @example\n * ```ts\n * addVitePlugin({\n * \t\tplugin,\n * \t\tconfig,\n * \t\tlogger,\n * \t\tupdateConfig\n * })\n * ```\n */\nexport const addVitePlugin = ({\n\twarnDuplicated = true,\n\tplugin,\n\tconfig,\n\tlogger,\n\tupdateConfig,\n}: UnsafeOptions | SafeOptions) => {\n\tif (warnDuplicated && config && logger && hasVitePlugin({ plugin, config })) {\n\t\tlogger.warn(\n\t\t\t`The Vite plugin \"${\n\t\t\t\t(plugin as Plugin).name\n\t\t\t}\" is already present in your Vite configuration, this plugin may not behave correctly.`,\n\t\t);\n\t}\n\n\tupdateConfig({\n\t\tvite: {\n\t\t\tplugins: [plugin],\n\t\t},\n\t});\n};\n","import { definePlugin } from \"../core/define-plugin.js\";\nimport {\n\ttype AddDevToolbarFrameworkAppParams,\n\taddDevToolbarFrameworkApp,\n} from \"../utilities/add-devtoolbar-framework-app.js\";\n\nexport const addDevToolbarFrameworkAppPlugin = definePlugin({\n\tname: \"addDevToolbarFrameworkApp\",\n\thook: \"astro:config:setup\",\n\timplementation:\n\t\t({ config, addDevToolbarApp, updateConfig, injectScript }) =>\n\t\t(\n\t\t\tparams: Omit<\n\t\t\t\tAddDevToolbarFrameworkAppParams,\n\t\t\t\t\"config\" | \"addDevToolbarApp\" | \"updateConfig\" | \"injectScript\"\n\t\t\t>,\n\t\t) =>\n\t\t\taddDevToolbarFrameworkApp({\n\t\t\t\t...params,\n\t\t\t\taddDevToolbarApp,\n\t\t\t\tupdateConfig,\n\t\t\t\tinjectScript,\n\t\t\t\tconfig,\n\t\t\t}),\n});\n","import { mkdirSync, readFileSync, writeFileSync } from \"node:fs\";\nimport { dirname, relative } from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\nimport type { AstroIntegrationLogger } from \"astro\";\nimport { parse, prettyPrint } from \"recast\";\nimport typescriptParser from \"recast/parsers/typescript.js\";\n\nconst injectEnvDTS = ({\n\tsrcDir,\n\tlogger,\n\tspecifier,\n}: {\n\tsrcDir: URL;\n\tlogger: AstroIntegrationLogger;\n\tspecifier: URL | string;\n}) => {\n\tconst envDTsPath = fileURLToPath(new URL(\"env.d.ts\", srcDir));\n\n\tif (specifier instanceof URL) {\n\t\tspecifier = fileURLToPath(specifier);\n\t\tspecifier = relative(fileURLToPath(srcDir), specifier);\n\t\tspecifier = specifier.replaceAll(\"\\\\\", \"/\");\n\t}\n\n\tconst envDTsContents = readFileSync(envDTsPath, \"utf8\");\n\n\tif (envDTsContents.includes(`/// <reference types='${specifier}' />`)) {\n\t\treturn;\n\t}\n\tif (envDTsContents.includes(`/// <reference types=\"${specifier}\" />`)) {\n\t\treturn;\n\t}\n\n\tconst newEnvDTsContents = envDTsContents\n\t\t.replace(\n\t\t\t`/// <reference types='astro/client' />`,\n\t\t\t`/// <reference types='astro/client' />\\n/// <reference types='${specifier}' />`,\n\t\t)\n\t\t.replace(\n\t\t\t`/// <reference types=\"astro/client\" />`,\n\t\t\t`/// <reference types=\"astro/client\" />\\n/// <reference types=\"${specifier}\" />`,\n\t\t);\n\n\t// the odd case where the user changed the reference to astro/client\n\tif (newEnvDTsContents === envDTsContents) {\n\t\treturn;\n\t}\n\n\twriteFileSync(envDTsPath, newEnvDTsContents);\n\tlogger.info(\"Updated env.d.ts types\");\n};\n\n/**\n * Allows to inject .d.ts file in users project. It will create a file inside `.astro`\n * and reference it from `src/env.d.ts`.\n *\n * @param {object} params\n * @param {string} params.name - The name of the .d.ts file. Eg `test` will generate `.astro/test.d.ts`\n * @param {string} params.content\n * @param {URL} params.root\n * @param {URL} params.srcDir\n * @param {import(\"astro\").AstroIntegrationLogger} params.logger\n *\n * @example\n * ```ts\n * addDts({\n * \t\tname: \"my-integration\",\n * \t \tcontent: `declare module \"virtual:my-integration\" {}`,\n * \t \troot,\n * \t \tsrcDir,\n * \t \tlogger\n * })\n * ```\n *\n * @see https://astro-integration-kit.netlify.app/utilities/add-dts/\n */\nexport const addDts = ({\n\tname,\n\tcontent,\n\troot,\n\tsrcDir,\n\tlogger,\n}: {\n\tname: string;\n\tcontent: string;\n\troot: URL;\n\tsrcDir: URL;\n\tlogger: AstroIntegrationLogger;\n}) => {\n\tconst dtsURL = new URL(`.astro/${name}.d.ts`, root);\n\tconst filePath = fileURLToPath(dtsURL);\n\n\tinjectEnvDTS({\n\t\tsrcDir,\n\t\tlogger,\n\t\tspecifier: dtsURL,\n\t});\n\n\tmkdirSync(dirname(filePath), { recursive: true });\n\twriteFileSync(\n\t\tfilePath,\n\t\tprettyPrint(\n\t\t\tparse(content, {\n\t\t\t\tparser: typescriptParser,\n\t\t\t}),\n\t\t\t{ tabWidth: 4 },\n\t\t).code,\n\t\t\"utf-8\",\n\t);\n};\n","import { definePlugin } from \"../core/define-plugin.js\";\nimport { addDts } from \"../utilities/add-dts.js\";\n\nexport const addDtsPlugin = definePlugin({\n\tname: \"addDts\",\n\thook: \"astro:config:setup\",\n\timplementation:\n\t\t({ logger, config: { root, srcDir } }) =>\n\t\t({ name, content }: { name: string; content: string }) =>\n\t\t\taddDts({ name, content, logger, root, srcDir }),\n});\n","import { type AstroIntegration, type HookParameters } from \"astro\";\nimport { hasIntegration } from \"./has-integration.js\";\n\nexport type AddIntegrationParams = {\n\tintegration: AstroIntegration;\n\toptions?:\n\t\t| {\n\t\t\t\tensureUnique?: boolean;\n\t\t  }\n\t\t| undefined;\n} & Pick<\n\tHookParameters<\"astro:config:setup\">,\n\t\"updateConfig\" | \"config\" | \"logger\"\n>;\n\n/**\n * Easily add an integration from within an integration.\n *\n * @param {import(\"astro\").AstroIntegration} integration\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"updateConfig\"]} params.updateConfig\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"config\"]} params.config\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"logger\"]} params.logger\n *\n * @example\n * ```ts\n * import Vue from \"@astrojs/vue\";\n *\n * addIntegration(Vue())\n * ```\n *\n * @see https://astro-integration-kit.netlify.app/utilities/add-integration/\n */\nexport const addIntegration = ({\n\tintegration,\n\toptions,\n\tupdateConfig,\n\tconfig,\n\tlogger,\n}: AddIntegrationParams) => {\n\tif (\n\t\toptions?.ensureUnique &&\n\t\thasIntegration({\n\t\t\tname: integration.name,\n\t\t\tconfig,\n\t\t})\n\t) {\n\t\tlogger.warn(\n\t\t\t`Integration \"${integration.name}\" has already been added by the user or another integration. Skipping.`,\n\t\t);\n\n\t\treturn;\n\t}\n\n\tupdateConfig({\n\t\tintegrations: [integration],\n\t});\n};\n","import type { HookParameters } from \"astro\";\nimport { AstroError } from \"astro/errors\";\n\ntype HasIntegrationParams = (\n\t| { position?: undefined; relativeTo?: string }\n\t| { position: \"before\" | \"after\"; relativeTo: string }\n) & {\n\tname: string;\n\tconfig: HookParameters<\"astro:config:setup\">[\"config\"];\n};\n\n/**\n * Checks whether an integration is already installed.\n *\n * If `before` is given, returns true only if the integration is installed before the named|provided integration.\n * If `after` is given, returns true only if the integration is installed after the named|provided integration.\n *\n * @param {object} params\n * @param {string} params.name - Integration to look up.\n * @param {undefined | \"before\" | \"after\"} params.position - Position in relation to another integration to check.\n * @param {undefined | string} params.relativeTo - Other integration to check for relative poisition.\n * @param {config} params.config\n *\n * @returns {boolean}\n *\n * @throws {AstroError} When `params.position` is defined but `params.relativeTo` isn't.\n *\n * @see https://astro-integration-kit.netlify.app/utilities/has-integration/\n *\n * @example\n * ```ts\n * hasIntegration({\n * \t\tname: \"@astrojs/tailwind\",\n * \t\tconfig\n * })\n * ```\n */\nexport const hasIntegration = ({\n\tname,\n\tposition,\n\trelativeTo,\n\tconfig,\n}: HasIntegrationParams): boolean => {\n\tconst integrationPosition = config.integrations.findIndex(\n\t\t(integration) => integration.name === name,\n\t);\n\n\t// Integration is not installed\n\tif (integrationPosition === -1) return false;\n\n\t// Not a relative check, the integration is present.\n\tif (position === undefined) return true;\n\n\tif (relativeTo === undefined)\n\t\tthrow new AstroError(\n\t\t\t\"Cannot perform a relative integration check without a relative reference.\",\n\t\t\t\"Pass `relativeTo` on your call to `hasIntegration` or remove the `position` option.\",\n\t\t);\n\n\tconst otherPosition = config.integrations.findIndex(\n\t\t(integration) => integration.name === relativeTo,\n\t);\n\n\tif (otherPosition === -1)\n\t\tthrow new AstroError(\n\t\t\t\"Cannot check relative position against an absent integration.\",\n\t\t);\n\n\treturn position === \"before\"\n\t\t? integrationPosition < otherPosition\n\t\t: integrationPosition > otherPosition;\n};\n","import { definePlugin } from \"../core/define-plugin.js\";\nimport {\n\ttype AddIntegrationParams,\n\taddIntegration,\n} from \"../utilities/add-integration.js\";\n\nexport const addIntegrationPlugin = definePlugin({\n\tname: \"addIntegration\",\n\thook: \"astro:config:setup\",\n\timplementation:\n\t\t({ updateConfig, config, logger }) =>\n\t\t(\n\t\t\tintegration: Pick<AddIntegrationParams, \"integration\">[\"integration\"],\n\t\t\toptions?: Pick<AddIntegrationParams, \"options\">[\"options\"],\n\t\t) =>\n\t\t\taddIntegration({\n\t\t\t\tintegration,\n\t\t\t\toptions,\n\t\t\t\tupdateConfig,\n\t\t\t\tconfig,\n\t\t\t\tlogger,\n\t\t\t}),\n});\n","import { definePlugin } from \"../core/define-plugin.js\";\nimport { addVirtualImports } from \"../utilities/add-virtual-imports.js\";\n\nexport const addVirtualImportsPlugin = definePlugin({\n\tname: \"addVirtualImports\",\n\thook: \"astro:config:setup\",\n\timplementation: ({ config, updateConfig }, { name }) => {\n\t\treturn (imports: Parameters<typeof addVirtualImports>[0][\"imports\"]) => {\n\t\t\taddVirtualImports({\n\t\t\t\tname,\n\t\t\t\timports,\n\t\t\t\tconfig,\n\t\t\t\tupdateConfig,\n\t\t\t});\n\t\t};\n\t},\n});\n","import type { PluginOption } from \"vite\";\nimport { definePlugin } from \"../core/define-plugin.js\";\nimport { addVitePlugin } from \"../utilities/add-vite-plugin.js\";\n\nexport const addVitePluginPlugin = definePlugin({\n\tname: \"addVitePlugin\",\n\thook: \"astro:config:setup\",\n\timplementation:\n\t\t({ config, logger, updateConfig }) =>\n\t\t(plugin: PluginOption) =>\n\t\t\taddVitePlugin({\n\t\t\t\tplugin,\n\t\t\t\tconfig,\n\t\t\t\tlogger,\n\t\t\t\tupdateConfig,\n\t\t\t}),\n});\n","import { definePlugin } from \"../core/define-plugin.js\";\nimport { hasIntegration } from \"../utilities/has-integration.js\";\n\nexport const hasIntegrationPlugin = definePlugin({\n\tname: \"hasIntegration\",\n\thook: \"astro:config:setup\",\n\timplementation:\n\t\t({ config }, { name }) =>\n\t\t(_name: string, position?: \"before\" | \"after\", relativeTo?: string) =>\n\t\t\thasIntegration({\n\t\t\t\tname: _name,\n\t\t\t\t// When `relativeTo` is not set get positions relative the current integration.\n\t\t\t\trelativeTo: relativeTo ?? name,\n\t\t\t\tposition,\n\t\t\t\tconfig: config,\n\t\t\t}),\n});\n","import type { AstroConfig } from \"astro\";\nimport type { Plugin, PluginOption } from \"vite\";\nimport { definePlugin } from \"../core/define-plugin.js\";\nimport { hasVitePlugin } from \"../utilities/has-vite-plugin.js\";\n\nfunction getPlugins(\n\tstore: Set<Plugin<any>>,\n\tplugins: AstroConfig[\"vite\"][\"plugins\"],\n) {\n\tif (plugins) {\n\t\tfor (const plugin of plugins) {\n\t\t\tif (!plugin) continue;\n\n\t\t\tif (Array.isArray(plugin)) {\n\t\t\t\tgetPlugins(store, plugin);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (plugin instanceof Promise) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tstore.add(plugin);\n\t\t}\n\t}\n\treturn store;\n}\n\nexport const hasVitePluginPlugin = definePlugin({\n\tname: \"hasVitePlugin\",\n\thook: \"astro:config:setup\",\n\timplementation: (params) => {\n\t\tconst currentPlugins = getPlugins(new Set(), params.config.vite?.plugins);\n\n\t\tconst { updateConfig, config } = params;\n\n\t\tparams.updateConfig = (newConfig) => {\n\t\t\tconfig.vite.plugins = Array.from(\n\t\t\t\tgetPlugins(currentPlugins, newConfig.vite?.plugins),\n\t\t\t);\n\t\t\treturn updateConfig(newConfig);\n\t\t};\n\n\t\treturn (plugin: string | PluginOption) =>\n\t\t\thasVitePlugin({\n\t\t\t\tplugin,\n\t\t\t\tconfig,\n\t\t\t});\n\t},\n});\n","import type { InjectedRoute } from \"astro\";\nimport type { HookParameters } from \"../core/types.js\";\n\ntype HookParameterProperties = Pick<\n\tHookParameters<\"astro:config:setup\">,\n\t\"command\" | \"injectRoute\"\n>;\n\n/**\n * Allows you to inject a route in development only\n *\n * @param {object} params\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"command\"]} params.command\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"injectRoute\"]} params.injectRoute\n * @param {import(\"astro\").InjectedRoute} params.injectedRoute\n *\n * @example\n * ```ts\n * injectDevRoute({\n *      command,\n *      injectRoute,\n *      injectedRoute: {\n *          pattern: \"/foo\",\n *          entrypoint: resolve(\"./pages/foo.astro\")\n *      },\n * })\n * ```\n *\n * @see https://astro-integration-kit.netlify.app/utilities/inject-dev-route/\n */\nexport const injectDevRoute = ({\n\tcommand,\n\tinjectRoute,\n\tinjectedRoute,\n}: HookParameterProperties & {\n\tinjectedRoute: InjectedRoute;\n}) => {\n\tif (command === \"dev\") {\n\t\tinjectRoute(injectedRoute);\n\t}\n};\n","import { definePlugin } from \"../core/define-plugin.js\";\nimport { injectDevRoute } from \"../utilities/inject-dev-route.js\";\n\nexport const injectDevRoutePlugin = definePlugin({\n\tname: \"injectDevRoute\",\n\thook: \"astro:config:setup\",\n\timplementation:\n\t\t({ command, injectRoute }) =>\n\t\t(injectedRoute: Parameters<typeof injectDevRoute>[0][\"injectedRoute\"]) =>\n\t\t\tinjectDevRoute({ command, injectRoute, injectedRoute }),\n});\n","import { readdirSync, statSync } from \"node:fs\";\nimport type { HookParameters } from \"astro\";\nimport { join, relative, resolve } from \"pathe\";\n\nconst getFilesRecursively = (dir: string, baseDir = dir) => {\n\tconst files = readdirSync(dir);\n\tlet filepaths: Array<string> = [];\n\n\tfor (const file of files) {\n\t\tconst filepath = join(dir, file);\n\t\tconst _stat = statSync(filepath);\n\n\t\tif (_stat.isDirectory()) {\n\t\t\t// Recursively get files from subdirectories\n\t\t\tconst subDirectoryFiles = getFilesRecursively(filepath, baseDir);\n\t\t\tfilepaths = filepaths.concat(subDirectoryFiles);\n\t\t} else {\n\t\t\t// Calculate relative path and add it to the array\n\t\t\tconst relativePath = relative(baseDir, filepath);\n\t\t\tfilepaths.push(relativePath);\n\t\t}\n\t}\n\n\treturn filepaths;\n};\n\n/**\n * In development, will reload the Astro dev server if any files within\n * the integration directory has changed.\n *\n * @param {object} params\n * @param {string} params.dir\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"addWatchFile\"]} params.addWatchFile\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"command\"]} params.command\n * @param {import(\"astro\").HookParameters<\"astro:config:setup\">[\"updateConfig\"]} params.updateConfig\n *\n * @see https://astro-integration-kit.netlify.app/utilities/watch-integration/\n *\n * @example\n * ```ts\n * watchIntegration({\n * \t\tdir: resolve(),\n * \t\taddWatchFile,\n * \t\tcommand,\n * \t\tupdateConfig,\n * })\n * ```\n */\nexport const watchIntegration = ({\n\taddWatchFile,\n\tcommand,\n\tdir,\n\tupdateConfig,\n}: {\n\taddWatchFile: HookParameters<\"astro:config:setup\">[\"addWatchFile\"];\n\tcommand: HookParameters<\"astro:config:setup\">[\"command\"];\n\tdir: string;\n\tupdateConfig: HookParameters<\"astro:config:setup\">[\"updateConfig\"];\n}) => {\n\tif (command !== \"dev\") {\n\t\treturn;\n\t}\n\n\tconst paths = getFilesRecursively(dir).map((p) => resolve(dir, p));\n\n\tfor (const path of paths) {\n\t\taddWatchFile(path);\n\t}\n\n\tupdateConfig({\n\t\tvite: {\n\t\t\tplugins: [\n\t\t\t\t{\n\t\t\t\t\tname: \"rollup-plugin-astro-tailwind-config-viewer\",\n\t\t\t\t\tbuildStart() {\n\t\t\t\t\t\tfor (const path of paths) {\n\t\t\t\t\t\t\tthis.addWatchFile(path);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t});\n};\n","import { definePlugin } from \"../core/define-plugin.js\";\nimport { watchIntegration } from \"../utilities/watch-integration.js\";\n\nexport const watchIntegrationPlugin = definePlugin({\n\tname: \"watchIntegration\",\n\thook: \"astro:config:setup\",\n\timplementation:\n\t\t({ addWatchFile, command, updateConfig }) =>\n\t\t(dir: string) =>\n\t\t\twatchIntegration({ dir, command, addWatchFile, updateConfig }),\n});\n","import { addDevToolbarFrameworkAppPlugin } from \"./add-devtoolbar-framework-app.js\";\nimport { addDtsPlugin } from \"./add-dts.js\";\nimport { addIntegrationPlugin } from \"./add-integration.js\";\nimport { addVirtualImportsPlugin } from \"./add-virtual-imports.js\";\nimport { addVitePluginPlugin } from \"./add-vite-plugin.js\";\nimport { hasIntegrationPlugin } from \"./has-integration.js\";\nimport { hasVitePluginPlugin } from \"./has-vite-plugin.js\";\nimport { injectDevRoutePlugin } from \"./inject-dev-route.js\";\nimport { watchIntegrationPlugin } from \"./watch-integration.js\";\n\nexport const corePlugins = [\n\thasVitePluginPlugin, // Has to be the first plugin to detect Vite plugins added from inside the integration\n\taddDtsPlugin,\n\taddVirtualImportsPlugin,\n\taddVitePluginPlugin,\n\thasIntegrationPlugin,\n\tinjectDevRoutePlugin,\n\twatchIntegrationPlugin,\n\taddDevToolbarFrameworkAppPlugin,\n\taddIntegrationPlugin,\n] as const;\n\nexport {\n\taddDtsPlugin,\n\taddVirtualImportsPlugin,\n\taddVitePluginPlugin,\n\thasIntegrationPlugin,\n\thasVitePluginPlugin,\n\tinjectDevRoutePlugin,\n\twatchIntegrationPlugin,\n\taddDevToolbarFrameworkAppPlugin,\n\taddIntegrationPlugin,\n};\n"],"mappings":"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","names":["definePlugin","plugin","readFileSync","fileURLToPath","dirname","resolve","createResolver","_base","base","path","AstroError","getPluginNames","plugins","names","plugin","hasVitePlugin","config","currentPlugins","name","addVitePlugin","warnDuplicated","plugin","config","logger","updateConfig","hasVitePlugin","incrementPluginName","name","count","_","c","resolveVirtualModuleId","id","createVirtualModule","_imports","imports","content","duplicatedImports","context","contexts","AstroError","resolutionMap","_import","options","resolution","data","addVirtualImports","config","updateConfig","pluginName","hasVitePlugin","addVitePlugin","addDevToolbarFrameworkApp","id","name","icon","framework","src","style","config","addDevToolbarApp","updateConfig","injectScript","virtualModuleName","resolve","createResolver","content","readFileSync","escapedIcon","addVirtualImports","react","preamble","addDevToolbarFrameworkAppPlugin","definePlugin","config","addDevToolbarApp","updateConfig","injectScript","params","addDevToolbarFrameworkApp","mkdirSync","readFileSync","writeFileSync","dirname","relative","fileURLToPath","parse","prettyPrint","typescriptParser","injectEnvDTS","srcDir","logger","specifier","envDTsPath","envDTsContents","newEnvDTsContents","addDts","name","content","root","dtsURL","filePath","addDtsPlugin","definePlugin","logger","root","srcDir","name","content","addDts","AstroError","hasIntegration","name","position","relativeTo","config","integrationPosition","integration","otherPosition","addIntegration","integration","options","updateConfig","config","logger","hasIntegration","addIntegrationPlugin","definePlugin","updateConfig","config","logger","integration","options","addIntegration","addVirtualImportsPlugin","definePlugin","config","updateConfig","name","imports","addVirtualImports","addVitePluginPlugin","definePlugin","config","logger","updateConfig","plugin","addVitePlugin","hasIntegrationPlugin","definePlugin","config","name","_name","position","relativeTo","hasIntegration","getPlugins","store","plugins","plugin","hasVitePluginPlugin","definePlugin","params","currentPlugins","updateConfig","config","newConfig","hasVitePlugin","injectDevRoute","command","injectRoute","injectedRoute","injectDevRoutePlugin","definePlugin","command","injectRoute","injectedRoute","injectDevRoute","readdirSync","statSync","join","relative","resolve","getFilesRecursively","dir","baseDir","files","filepaths","file","filepath","subDirectoryFiles","relativePath","watchIntegration","addWatchFile","command","updateConfig","paths","p","path","watchIntegrationPlugin","definePlugin","addWatchFile","command","updateConfig","dir","watchIntegration","corePlugins","hasVitePluginPlugin","addDtsPlugin","addVirtualImportsPlugin","addVitePluginPlugin","hasIntegrationPlugin","injectDevRoutePlugin","watchIntegrationPlugin","addDevToolbarFrameworkAppPlugin","addIntegrationPlugin"]}