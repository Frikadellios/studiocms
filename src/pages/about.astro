---
import { Admins,  Pages, db, eq } from 'astro:db';
import { marked } from 'marked';
import Layout from '../layouts/BlogPost.astro';
import type { Locals } from './dashboard/locals';

const locals = Astro.locals as Locals;
const isLoggedIn = locals.isLoggedIn;

const postArrayed = await db.select().from(Pages).where(eq(Pages.slug, "about"));

const post = postArrayed[0];

const adminList = await db.select().from(Admins);

const isAdmin = async (user: string) => {
    if (adminList.includes({GitHubUsername: user})) {
        return true;
    }
    return false;
};

type Props = {
	post: typeof Pages.$inferSelect;
};
---

<Layout
	title={post.title}
	description={post.description}
	publishedAt={post.publishedAt}
	heroImage={post.heroImage}
>
	{ //@ts-ignore
	isLoggedIn && isAdmin(locals.dbUser.username) && (
		<a href={`/dashboard/edit/about`}><button class="btn">✏️ Edit Page</button></a>
		)}
	<Fragment 
		set:html={marked(post.content, { async: true })} />
</Layout>
