---
import { Blog, db, eq } from 'astro:db';
import { marked } from 'marked';
import BlogPost from '../../layouts/BlogPost.astro';

const { slug } = Astro.params;

if (!slug) {
	return Astro.redirect('/404');
}

const postArrayed = await db.select().from(Blog).where(eq(Blog.slug, slug));

const post = postArrayed[0];

if (!post) {
	return Astro.redirect('/404');
}

type Props = {
	post: typeof Blog.$inferSelect;
};
---

<BlogPost 
	title={post.title} 
	description={post.description} 
	heroImage={post.heroImage} 
	publishedAt={post.publishedAt} 
	updatedAt={post.updatedAt} >
	<Fragment 
		set:html={marked(post.content, { async: true })} />
</BlogPost>
